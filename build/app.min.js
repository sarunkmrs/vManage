function initUser(){if(APP.CONFIG.data.noaccess)APP.USER.ROLE=0,APP.USER.LANDING="noaccess";else{var a=angular.isDefined(APP.CONFIG.data.user.type)?APP.CONFIG.data.user.type:void 0;switch(APP.USER.ROLE=angular.isDefined(a)?APP.USER.ROLES[a]:0,a){case"SUPER_ADMIN":APP.USER.LANDING="dashboard";break;case"LOCAL_ADMIN":APP.USER.LANDING="dashboard";break;case"RECEPTION_GUARD":APP.USER.LANDING="dashboard";break;case"EMPLOYEE":APP.USER.LANDING="myvisitors";break;case"CONTRACTOR":APP.USER.LANDING="myvisitors";break;case void 0:APP.USER.LANDING="noaccess";break;default:APP.USER.LANDING="myvisitors"}}}function removeModal(){$(".modal, .modal-backdrop").remove(),$("body").removeClass("modal-open")}function createDateTime(a,b){var c=b.substr(b.length-2).toLowerCase(),d=b.substring(0,b.indexOf(":")),e=b.substring(b.indexOf(":")+1,b.indexOf(" "));return d="pm"==c?"12"==d?"12":parseInt(d,10)+12:"12"==d?"00":parseInt(d,10),d.length<2&&(d="0"+d),getTimestamp(a+" "+d+":"+e+":00")}function getTimestamp(a){var b=a.match(/\d+/g);return+new Date(b[0],b[1]-1,b[2],b[3],b[4],b[5])}APP.LANGUAGES=[],APP.USER={},APP.USER.ROLES={SUPER_ADMIN:1,LOCAL_ADMIN:2,RECEPTION_GUARD:4,EMPLOYEE:8,CONTRACTOR:16},APP.PAGEACCESS={},APP.PAGEACCESS.dashboard=APP.USER.ROLES.SUPER_ADMIN|APP.USER.ROLES.LOCAL_ADMIN|APP.USER.ROLES.RECEPTION_GUARD,APP.PAGEACCESS.myvisitors=APP.USER.ROLES.SUPER_ADMIN|APP.USER.ROLES.LOCAL_ADMIN|APP.USER.ROLES.RECEPTION_GUARD|APP.USER.ROLES.EMPLOYEE|APP.USER.ROLES.CONTRACTOR,APP.PAGEACCESS.schedule=APP.USER.ROLES.SUPER_ADMIN|APP.USER.ROLES.LOCAL_ADMIN|APP.USER.ROLES.RECEPTION_GUARD|APP.USER.ROLES.EMPLOYEE|APP.USER.ROLES.CONTRACTOR,APP.PAGEACCESS.bulkschedule=APP.USER.ROLES.SUPER_ADMIN|APP.USER.ROLES.LOCAL_ADMIN|APP.USER.ROLES.RECEPTION_GUARD|APP.USER.ROLES.EMPLOYEE|APP.USER.ROLES.CONTRACTOR,APP.PAGEACCESS.reports=APP.USER.ROLES.SUPER_ADMIN|APP.USER.ROLES.LOCAL_ADMIN|APP.USER.ROLES.RECEPTION_GUARD,APP.PAGEACCESS.settings=APP.USER.ROLES.SUPER_ADMIN|APP.USER.ROLES.LOCAL_ADMIN,APP.PAGEACCESS.admin=APP.USER.ROLES.SUPER_ADMIN|APP.USER.ROLES.LOCAL_ADMIN,APP.PAGEACCESS.bannedvisitors=APP.USER.ROLES.SUPER_ADMIN|APP.USER.ROLES.LOCAL_ADMIN,APP.PAGEACCESS.bannedschedules=APP.USER.ROLES.SUPER_ADMIN|APP.USER.ROLES.LOCAL_ADMIN,APP.PAGEACCESS.badge=APP.USER.ROLES.SUPER_ADMIN|APP.USER.ROLES.LOCAL_ADMIN,APP.PAGEACCESS.noaccess=0;var app=angular.module("vmApp",["ngRoute","ngSanitize","ngCookies","ngAnimate","ui.bootstrap","dialogs.main","angularFileUpload","xeditable","infinite-scroll","countTo","ui.select","angulartics","angulartics.google.analytics","FBAngular","gridster","gm.datepickerMultiSelect","checklist-model","ngToast"]);app.config(["$routeProvider","ngToastProvider","$analyticsProvider",function(a,b,c){initUser(),a.when("/dashboard",{controller:"DashboardController",templateUrl:"app/partials/dashboard.html",requireLogin:!0,access:APP.PAGEACCESS.dashboard}).when("/schedule/:scheduleID/:parentPage",{controller:"ScheduleController",templateUrl:"app/partials/schedule.html",requireLogin:!0,access:APP.PAGEACCESS.schedule}).when("/schedule",{controller:"ScheduleController",templateUrl:"app/partials/schedule.html",requireLogin:!0,access:APP.PAGEACCESS.schedule}).when("/bulkschedule",{controller:"BulkScheduleController",templateUrl:"app/partials/bulk-schedule.html",requireLogin:!0,access:APP.PAGEACCESS.bulkschedule}).when("/reports",{controller:"ReportsController",templateUrl:"app/partials/reports.html",requireLogin:!0,access:APP.PAGEACCESS.reports}).when("/myvisitors",{controller:"MyVisitorController",templateUrl:"app/partials/my-visitor.html",requireLogin:!0,access:APP.PAGEACCESS.myvisitors}).when("/settings",{controller:"SettingsController",templateUrl:"app/partials/settings.html",requireLogin:!0,access:APP.PAGEACCESS.settings}).when("/admin",{controller:"AdminController",templateUrl:"app/partials/admin.html",requireLogin:!0,access:APP.PAGEACCESS.admin}).when("/bannedvisitors",{controller:"BannedVisitorController",templateUrl:"app/partials/banned-visitors.html",requireLogin:!0,access:APP.PAGEACCESS.bannedvisitors}).when("/bannedschedules",{controller:"BannedScheduleController",templateUrl:"app/partials/banned-schedules.html",requireLogin:!0,access:APP.PAGEACCESS.bannedschedules}).when("/badge",{controller:"BadgeController",templateUrl:"app/partials/badge.html",requireLogin:!0,access:APP.PAGEACCESS.badge}).when("/noaccess",{controller:"NoaccessController",templateUrl:"app/partials/noaccess.html",requireLogin:!1,access:0}).otherwise({redirectTo:"/"+APP.USER.LANDING}),c.virtualPageviews(!0)}]).run(["$rootScope","$location","editableOptions","$templateCache",function(a,b,c,d){c.theme="bs3",a.$on("$routeChangeStart",function(a,c){!c.requireLogin||c.access&APP.USER.ROLE||b.path("/"+APP.USER.LANDING)}),d.put("template/tooltip/tooltip-html-unsafe-popup.html",'<div class="tooltip {{placement}}{{popupClass}}" ng-class="{ in: isOpen(), fade: animation() }"><div class="tooltip-arrow"></div><div class="tooltip-inner" bind-html-unsafe="content"></div></div>')}]),app.controller("AdminController",["$scope","$rootScope",function(a,b){function c(){a.pageList=[{name:a.translation.ADMIN.USER_MENU,type:"user",icon:"fa-user",url:"app/partials/admin-templates/user-management.html"},{name:a.translation.ADMIN.LOCATION_MENU,type:"location",icon:"fa-map-marker",url:"app/partials/admin-templates/location-settings.html"}],a.pageName=a.pageList[0].name,a.pageIcon=a.pageList[0].icon,a.pageTemplate=a.pageList[0].url,a.translation.REPORTS.TYPE=a.translation.VISITOR_REPORTS.TITLE}return b.location?(c(),a.changeLocation=function(a){b.location=a,b.$broadcast("locationChange",a)},a.changeAdmin=function(b){a.pageName=b.name,a.pageIcon=b.icon,a.pageTemplate=b.url},void a.$on("languageChange",function(){a.pageList=[{name:a.translation.ADMIN.USER_MENU,type:"user",icon:"fa-user",url:"app/partials/admin-templates/user-management.html"},{name:a.translation.ADMIN.LOCATION_MENU,type:"location",icon:"fa-map-marker",url:"app/partials/admin-templates/location-settings.html"}],angular.forEach(a.pageList,function(b){b.url==a.pageTemplate&&(a.pageName=b.name)})})):!1}]),app.controller("AppController",["$scope","$rootScope","$cookies","$location","$timeout","AppService","Utils","Fullscreen",function(a,b,c,d,e,f,g,h){function i(){if(b.config={},b.config.dateFormat="MMM d, y",b.config.today=new Date,a.access=!0,a.errorCode=!1,a.showAvatar=!1,null==APP.CONFIG||angular.isUndefined(APP.CONFIG.data)||null==APP.CONFIG.data)a.access=!1;else{var d=APP.CONFIG.data;angular.isUndefined(d.user)||null==d.user||angular.isUndefined(d.user.sso)?a.access=!1:(a.user=d.user,g.isImage(a.user.sso).then(function(b){a.showAvatar=b})),0==d.locations.length?a.access=!1:(b.location="",b.locations=d.locations,angular.forEach(b.locations,function(a){a.isHome&&(b.location=a.id)}));var e=!1;b.languages=d.languages,angular.forEach(b.languages,function(a){a.isPreferred&&(e=a.code)}),angular.isUndefined(APP.CONFIG.data.user)&&(e="en-GB"),c.langCode=c.langCode?c.langCode:e,b.langCode=c.langCode,b.translation=APP.LANGUAGES[c.langCode]}}i(),a.changeLanguage=function(d){c.langCode=d,b.langCode=c.langCode,b.translation=APP.LANGUAGES[c.langCode],b.$broadcast("languageChange"),1==APP.CONFIG.exception.status&&(a.access=!1,f.showMessage("danger",b.translation.GLOBAL[APP.CONFIG.exception.code]))},a.showMenu=function(a){var b=APP.PAGEACCESS.hasOwnProperty(a)?APP.PAGEACCESS[a]:APP.PAGEACCESS.noaccess;return APP.USER.ROLE&b},a.isActiveMenu=function(a){return-1!=d.path().indexOf(a)},a.closeMessage=function(){a.message.type="",a.message.text="",a.message.show=!1},a.logout=function(){var a="",b=d.absUrl().split("#")[0];a="securityportal.corporate.ge.com"==d.host()?"https://ssousflogin.corporate.ge.com/logoff/logoff.jsp?referrer=":"https://ssousflogin.stage.corporate.ge.com/logoff/logoff.jsp?referrer=",a=a+b+"?rnd="+Math.random(),window.location=a},angular.isUndefined(c.SMSESSION)||null===c.SMSESSION,h.$on("FBFullscreen.change",function(){e(function(){a.inFullScreen=h.isEnabled()})}),a.toggleFullScreen=function(){h.isEnabled()?h.cancel():h.all()}}]),app.controller("BadgeController",["$scope","$rootScope",function(a,b){function c(){a.gridsterOptions={margins:[5,5],columns:4,draggable:{handle:"h3"}},a.dashboards={1:{id:"1",name:"Home",widgets:[{col:0,row:0,sizeY:1,sizeX:1,name:"Widget 1"},{col:2,row:1,sizeY:1,sizeX:1,name:"Widget 2"}]},2:{id:"2",name:"Other",widgets:[{col:1,row:1,sizeY:1,sizeX:2,name:"Other Widget 1"},{col:1,row:3,sizeY:1,sizeX:1,name:"Other Widget 2"}]}},a.clear=function(){a.dashboard.widgets=[]},a.addWidget=function(){a.dashboard.widgets.push({name:"New Widget",sizeX:1,sizeY:1})},a.$watch("selectedDashboardId",function(b,c){a.dashboard=b!==c?a.dashboards[b]:a.dashboards[1]}),a.selectedDashboardId="1"}return b.location?void c():!1}]),app.controller("BannedScheduleController",["$scope","$rootScope","AppService","BannedScheduleService","Utils","dialogs",function(a,b,c,d,e,f){function g(){a.busy=!1,a.after=0,a.schedules=[],d.getSchedules().then(function(b){c.checkException(a,b.data.exception),a.schedules=b.data.data,h()})}function h(){angular.forEach(a.schedules,function(a){a.tooltip="",a.showAvatar=!1,a.visitorPic?a.tooltip='<span class="avatar md"><img src="vm/resources/visitorphoto?recordId='+visitor.id+'" /></span>':(a.visitorSSO=angular.isUndefined(a.visitorSSO)||null===a.visitorSSO?"":a.visitorSSO,e.isImage(a.visitorSSO).then(function(b){a.showAvatar=b,a.showAvatar&&(a.tooltip='<span class="avatar md"><img src="http://supportcentral.gecdn.com/images/person/temp/'+a.visitorSSO+'.jpg" /></span>')}))})}return b.location?(g(),a.loadMore=function(){return a.busy||a.after>=10?!1:(a.busy=!0,void d.getSchedules(a.after).then(function(b){c.checkException(a,b.data.exception),b.data.data.length&&angular.forEach(b.data.data,function(b){a.schedules.push(b)}),a.busy=!1,a.after+=1,h()}))},a.changeLocation=function(e){c.updateUserAccess(e),b.location=e,d.getSchedules().then(function(b){c.checkException(a,b.data.exception),a.schedules=b.data.data,h()})},a.approve=function(e,f){var g={id:e};d.approve(g).then(function(d){var e=c.checkException(a,d.data.exception);e||(a.schedules.splice(f,1),c.showMessage("success",b.translation.BANNED_SCHEDULES.APPROVED))})},a.reject=function(e,g){f.confirm(b.translation.BANNED_SCHEDULES.REJECT_TITLE,b.translation.BANNED_SCHEDULES.REJECT_CONFIRMATION,{keyboard:!1,backdrop:"static",size:"md"}).result.then(function(){var f={id:e};d.reject(f).then(function(d){var e=c.checkException(a,d.data.exception);e||(a.schedules.splice(g,1),c.showMessage("success",b.translation.BANNED_SCHEDULES.REJECTED))})},function(){})},void(a.help=function(){b.page="bannedschedules";var a=f.create("app/partials/help.html","HelpController",{},{keyboard:!1,backdrop:"static",size:"md"});a.result.then(function(){},function(){})})):!1}]),app.controller("BannedVisitorController",["$scope","$rootScope","AppService","VisitorsService","Utils","dialogs","$filter",function(a,b,c,d,e,f,g){function h(){a.busy=!1,a.after=0,a.bannedVisitors=[],d.getBannedVisitors().then(function(b){c.checkException(a,b.data.exception),a.bannedVisitors=b.data.data,i()})}function i(){angular.forEach(a.bannedVisitors,function(a){j(a)})}function j(a){a.tooltipVisitor=a.tooltipRequester="",a.showAvatarVisitor=a.showAvatarRequester=!1,a.visitorPic?a.tooltip='<span class="avatar md"><img src="vm/resources/bannedvisitorphoto?recordId='+a.recordId+'" /></span>':(a.sso=angular.isUndefined(a.sso)||null===a.sso?"":a.sso,e.isImage(a.sso).then(function(b){a.showAvatarVisitor=b,a.showAvatarVisitor&&(a.tooltipVisitor='<span class="avatar md"><img src="http://supportcentral.gecdn.com/images/person/temp/'+a.sso+'.jpg" /></span>')})),e.isImage(a.requesterSSO).then(function(b){a.showAvatarRequester=b,a.showAvatarRequester&&(a.tooltipRequester='<span class="avatar md"><img src="http://supportcentral.gecdn.com/images/person/temp/'+a.requesterSSO+'.jpg" /></span>')})}return b.location?(h(),a.loadMore=function(){return a.busy||a.after>=10?!1:(a.busy=!0,void d.getBannedVisitors(a.after).then(function(b){c.checkException(a,b.data.exception),b.data.data.length&&angular.forEach(b.data.data,function(b){a.bannedVisitors.push(b)}),a.busy=!1,a.after+=1,i()}))},a.changeLocation=function(e){c.updateUserAccess(e),b.location=e,d.getBannedVisitors().then(function(b){c.checkException(a,b.data.exception),a.bannedVisitors=b.data.data,i()})},a.bann=function(b){var e=angular.isDefined(b);f.create("app/partials/bann-modal.html","BannVisitorController",b,{keyboard:!1,backdrop:"static",size:"md"}).result.then(function(b){var f={task:e?"update":"create",recordId:angular.isDefined(b.recordId)?b.recordId:null,sso:b.sso,firstName:b.firstName,lastName:b.lastName,datastream:angular.isDefined(b.datastream)?b.datastream:null,reason:b.reason,startDate:g("date")(new Date(b.startDate),"yyyy-MM-dd"),endDate:g("date")(new Date(b.endDate),"yyyy-MM-dd"),forever:angular.isDefined(b.forever)?b.forever:!1};d.bann(f).then(function(b){var d=c.checkException(a,b.data.exception);if(!d){var f=b.data.data;j(f),e?(c.showMessage("success",a.translation.BANNED_VISITORS.UPDATED),angular.forEach(a.bannedVisitors,function(a){a.recordId==f.recordId&&(a.sso=f.sso,a.firstName=f.firstName,a.lastName=f.lastName,a.startDate=f.startDate,a.endDate=f.endDate,a.forever=f.forever,a.reason=f.reason,a.datastream=f.datastream,a.visitorPic=f.visitorPic,a.requesterSSO=a.requesterSSO,a.requesterFirstName=a.requesterFirstName,a.requesterLastName=a.requesterLastName)})):(c.showMessage("success",a.translation.BANNED_VISITORS.ADDED),a.bannedVisitors.splice(0,0,f))}})},function(){})},void(a.removeBann=function(e,g){f.confirm(b.translation.BANNED_VISITORS.REMOVE_TITLE,b.translation.BANNED_VISITORS.REMOVE_CONFIRMATION,{keyboard:!1,backdrop:"static",size:"md"}).result.then(function(){var f={recordId:e.recordId};d.removeBann(f).then(function(d){var e=c.checkException(a,d.data.exception);e||(a.bannedVisitors.splice(g,1),c.showMessage("success",b.translation.BANNED_VISITORS.REMOVED))})},function(){})})):!1}]),app.controller("BannVisitorController",["$scope","$rootScope","$uibModalInstance","data","Utils","dialogs","VisitorsService","ScheduleService","AppService","$filter",function(a,b,c,d,e,f,g,h,i,j){function k(){if(a.webcamSupported=_.includes(["chrome","firefox","opera"],i.getBrowserType()),a.visitorTypes=[{id:"visitor",name:b.translation.SCHEDULE.NON_GE_VISITOR},{id:"geemployee",name:b.translation.SCHEDULE.GE_EMPLOYEE},{id:"pastvisitor",name:b.translation.SCHEDULE.PAST_VISITOR}],a.visitorType="visitor",a.onEditPage=angular.isDefined(d),a.item={},a.item.startDate=a.item.endDate=new Date,a.openCalendar=function(b,c){b.preventDefault(),b.stopPropagation(),"start"==c?(a.startOpened=!0,a.endOpened=!1):(a.startOpened=!1,a.endOpened=!0)},a.showMinDate=function(){a.minDate=new Date},a.showMinDate(),a.showMaxDate=function(){},a.showMaxDate(),a.showEndMinDate=function(){a.minEndDate=a.item.startDate},a.showEndMinDate(),a.showEndMaxDate=function(){},a.showEndMaxDate(),a.changeEndDate=function(){a.item.startDate>a.item.endDate&&(a.item.endDate=a.item.startDate),a.showEndMinDate()},angular.isDefined(d)){a.item=d,a.item.startDate=j("date")(d.startDate,b.config.dateFormat),a.item.endDate=j("date")(d.endDate,b.config.dateFormat);var c=createDateTime(j("date")(new Date(a.item.startDate),"yyyy-MM-dd"),"00:00:00"),f=createDateTime(j("date")(new Date(a.minDate),"yyyy-MM-dd"),"00:00:00");a.minDate=f>c?c:a.minDate,a.showAvatar=!1,e.isImage(a.item.sso).then(function(b){a.showAvatar=b}),g.getBannedVisitor(d.recordId).then(function(b){var c=i.checkException(a,b.data.exception);c||(a.item.datastream=b.data.data.datastream)})}}k(),a.switchLookup=function(){a.item.geUser=null,a.item.pastVisitor=null,a.item.recordId=null,a.item.visitorId=null,a.item.sso=null,a.item.firstName=null,a.item.lastName=null,a.item.email=null,a.item.datastream=null,a.item.visitorPic=null},a.ok=function(){c.close(a.item)},a.cancel=function(){c.dismiss("canceled")},a.getGEUsers=function(a){return h.getGEUsers(a).then(function(a){var b=a.data["json-service"].services[0].response.data,c=[];return angular.forEach(b,function(a){c.push({sso:a[0],name:a[1]+" ("+a[0]+")",firstName:a[1].split(", ")[0],lastName:a[1].split(", ")[1],email:a[6],company:a[2]})}),c})},a.onSelectGEUser=function(b){a.item.visitorId=b.visitorId,a.item.sso=b.sso,a.item.firstName=b.firstName,a.item.lastName=b.lastName,a.item.email=b.email,e.isImage(a.item.sso).then(function(b){a.showAvatar=b})},a.getPastVisitors=function(a){return h.getPastVisitors(a).then(function(a){var b=[];return angular.forEach(a.data.data,function(a){a.sso=angular.isUndefined(a.sso)||null===a.sso?"":a.sso,b.push({recordId:a.recordId,visitorId:a.visitorId,sso:a.sso,name:a.visitor,firstName:a.firstName,lastName:a.lastName,email:a.email,phone:a.phone,company:a.company,datastream:a.datastream,visitorPic:a.visitorPic})}),b})},a.onSelectPastVisitor=function(b){a.item.visitorId=b.recordId,a.item.sso=b.sso,a.item.firstName=b.firstName,a.item.lastName=b.lastName,a.item.email=b.email,a.item.datastream=b.datastream,a.item.visitorPic=b.visitorPic,e.isImage(a.item.sso).then(function(b){a.showAvatar=b}),a.item.visitorPic&&g.getVisitorPic(b.recordId).then(function(b){var c=i.checkException(a,b.data.exception);c||(a.item.datastream=b.data.data.datastream)})},a.capture=function(){f.create("app/partials/capture.html","CaptureController",{},{keyboard:!1,backdrop:"static",size:"md"}).result.then(function(b){a.item.datastream=b},function(){})},a.help=function(){b.page="bannedvisitors";var a=f.create("app/partials/help.html","HelpController",{},{keyboard:!1,backdrop:"static",size:"md"});a.result.then(function(){},function(){})}}]),app.controller("BulkScheduleController",["$scope","$rootScope","$location","$filter","AppService","ScheduleService","VisitorsService","$upload",function(a,b,c,d,e,f,g,h){function i(){k(),a.schedule={},f.getPreferences().then(function(c){var d=e.checkException(a,c.data.exception);d||(a.schedule.hosts=c.data.data.hosts,$(".instr_list").hide(),$("#instructionList option:first").html("-"+b.translation.SCHEDULE.SPECIAL_INSTRUCTIONS+"-"),a.schedule.instructionLists=c.data.data.instructions,j())})}function j(){a.schedule.scheduledArrival=new Date,a.schedule.scheduledDeparture=new Date,a.schedule.arrivalTime=createDateTime(d("date")(new Date(a.schedule.scheduledArrival),"yyyy-MM-dd"),"08:00 AM"),a.schedule.departureTime=createDateTime(d("date")(new Date(a.schedule.scheduledArrival),"yyyy-MM-dd"),"05:00 PM"),angular.forEach(a.schedule.hosts,function(b){b.id==a.user.sso&&(a.schedule.host=b)})}function k(){a.isRussia=!1,angular.forEach(b.locations,function(c){b.location==c.id&&c.isRussia&&(a.isRussia=!0)})}return b.location?(i(),a.changeLocation=function(c){e.updateUserAccess(c),b.location=c,k(),a.schedule.host=null,a.schedule.hosts=[],$(".instr_list").show(),$("#instructionList option:first").html(b.translation.SCHEDULE.LOADING),f.getPreferences().then(function(c){var d=e.checkException(a,c.data.exception);d||(a.schedule.hosts=c.data.data.hosts,angular.forEach(a.schedule.hosts,function(b){b.id==a.user.sso&&(a.schedule.host=b)}),$(".instr_list").hide(),$("#instructionList option:first").html("-"+b.translation.SCHEDULE.SPECIAL_INSTRUCTIONS+"-"),a.schedule.instructionLists=c.data.data.instructions,a.schedule.instructionList=null)})},a.execute=function(c){if(a.scheduleForm.$invalid)return!1;if(a.schedule.arrival=createDateTime(d("date")(new Date(a.schedule.scheduledArrival),"yyyy-MM-dd"),d("date")(new Date(a.schedule.arrivalTime),"h:mm a")),a.schedule.departure=createDateTime(d("date")(new Date(a.schedule.scheduledDeparture),"yyyy-MM-dd"),d("date")(new Date(a.schedule.departureTime),"h:mm a")),a.schedule.arrival>=a.schedule.departure)return void e.showMessage("danger",b.translation.SCHEDULE.ERROR_DATE);$(".actionBtn").attr("disabled","disabled");var g={task:c,fileName:a.uploadResult.fileName,hostId:e.getVal(a.schedule.host.id),hostName:e.getVal(a.schedule.host.name),destinationName:"",escortRequired:e.getVal(a.schedule.escortRequired,!0),instructions:e.getVal(a.schedule.instructions),scheduledArrival:d("date")(a.schedule.arrival,"yyyy-MM-dd HH:mm:ss"),scheduledDeparture:d("date")(a.schedule.departure,"yyyy-MM-dd HH:mm:ss")};a.schedule.instructionLists.length&&(a.schedule.instructionList?(g.instructionId=e.getVal(a.schedule.instructionList.id),g.instructionName=e.getVal(a.schedule.instructionList.name)):(g.instructionId=null,g.instructionName=null)),f.bulkSchedule(g).then(function(c){$(".actionBtn").removeAttr("disabled");var d=e.checkException(a,c.data.exception);if(!d){a.resetForm();var f=c.data.count,g=f>0?b.translation.SCHEDULE.CREATED+" <br /> "+f+b.translation.SCHEDULE.COUNT_MESSAGE:b.translation.SCHEDULE.CREATED;e.showMessage("success",g)}})},a.resetForm=function(){var b=a.schedule.hosts,c=a.schedule.instructionLists;a.schedule={},a.schedule.host=null,a.schedule.hosts=b,a.schedule.instructionLists=c,a.cancelUploads(),j()},a.openCalendar=function(b,c){b.preventDefault(),b.stopPropagation(),"arrival"==c?a.arrivalOpened=!0:a.departureOpened=!0},a.showMinDate=function(){a.minDate=a.minDate?null:new Date},a.showMinDate(),a.showDepartureMinDate=function(){a.minDepartureDate=a.schedule.scheduledArrival},a.showDepartureMinDate(),a.changeDepartureDate=function(){a.schedule.scheduledArrival>a.schedule.scheduledDeparture&&(a.schedule.scheduledDeparture=a.schedule.scheduledArrival),a.showDepartureMinDate()},a.$on("languageChange",function(){f.getPreferences().then(function(c){var d=e.checkException(a,c.data.exception);d||($(".host_list").hide(),$("#host option:first").html("-"+b.translation.SCHEDULE.HOST_SELECTION+"-"),$(".instr_list").hide(),$("#instructionList option:first").html("-"+b.translation.SCHEDULE.SPECIAL_INSTRUCTIONS+"-"),a.schedule.instructionLists=c.data.data.instructions)})}),a.onFileSelect=function(c){if(a.selectedFiles=[],a.progress=[],a.upload&&a.upload.length>0)for(var d=0;d<a.upload.length;d++)null!=a.upload[d]&&a.upload[d].abort();a.upload=[],a.uploadResult=[],a.selectedFiles=c;for(var d=0;d<c.length;d++){var f=c[d],g=f.name.split(".").pop();if("xlsx"!=g&&"xls"!=g)return a.cancelUploads(),e.showMessage("danger",b.translation.BULK_SCHEDULE.UPLOAD_ERROR),!1;a.progress[d]=-1,a.start(d)}},a.start=function(b){a.progress[b]=0,a.upload=h.upload({url:"vm/resources/UploadVisitorDoc",method:"POST",file:a.selectedFiles[b]}).progress(function(c){a.progress[b]=parseInt(100*c.loaded/c.total)}).success(function(b){var c=e.checkException(a,b.exception);return c?(a.sucess=!1,!1):(a.sucess=!0,void(a.uploadResult=b))})},void(a.cancelUploads=function(){a.uploadResult={},a.selectedFiles=[],a.selectedFiles=null,a.sucess=!1})):!1}]),app.controller("CaptureController",["$scope","$timeout","$uibModalInstance",function(a,b,c){function d(){a.notSupported=!1,a.notStarted=!1,function(){navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,window.hasUserMedia=function(){return navigator.getMedia?!0:!1}}(),a.datastream=null,b(function(){if(!window.hasUserMedia())return void b(function(){a.notSupported=!0});a.video=document.getElementById("video"),a.video.setAttribute("autoplay",""),a.canvas=document.getElementById("canvas"),a.context=a.canvas.getContext("2d"),a.localMediaStream=null;var c={video:!0,audio:!1};navigator.getMedia(c,function(b){if(navigator.mozGetUserMedia)a.video.mozSrcObject=b;else{var c=window.URL||window.webkitURL;a.video.src=c.createObjectURL(b)}a.localMediaStream=b,e(),a.video.play()},function(){b(function(){a.notStarted=!0})})})}function e(){b(function(){a.canvas.width=240,$("#video").innerWidth(),a.canvas.height=200,$("#video").innerHeight()})}d(),a.ok=function(){if(a.video){a.context.drawImage(a.video,0,0,a.canvas.width,a.canvas.height);var b=a.context.getImageData(0,0,a.canvas.width,a.canvas.height);a.context.putImageData(b,0,0),a.datastream=a.canvas.toDataURL(),a.stop(),c.close(a.datastream)}},a.cancel=function(){a.stop(),c.dismiss("canceled")},a.stop=function(){if(a.localMediaStream){var b="function"==typeof a.localMediaStream.getVideoTracks;if(a.localMediaStream.getVideoTracks&&b){var c=a.localMediaStream.getVideoTracks();c&&c[0]&&c[0].stop&&c[0].stop()}else a.localMediaStream.stop&&a.localMediaStream.stop()}}}]),app.controller("CheckInController",["$scope","$rootScope","$uibModalInstance","data","Utils","dialogs","ScheduleService","AppService",function(a,b,c,d,e,f,g,h){function i(){a.webcamSupported=_.includes(["chrome","firefox","opera"],h.getBrowserType()),j(),a.item={},a.item.id=d.id,a.item.sso=angular.isUndefined(d.sso)||null===d.sso?"":d.sso,a.item.badge="",a.item.visitor=d.visitor,a.item.instructions=d.instructions?d.instructions:a.translation.SCHEDULE.INSTRUCTIONS,a.item.specialInstruction=d.specialInstruction?d.specialInstruction:null,a.item.escortRequired=d.escortRequired,a.item.datastream=d.datastream,a.item.visitorPic=d.visitorPic,a.item.adds={},a.item.fileds=[],g.getAdditionalFields(d.id).then(function(b){var c=h.checkException(a,b.data.exception);if(!c)for(a.item.fileds=b.data.data,angular.forEach(a.item.fileds,function(b){a.item.adds[b.key]=b.value}),a.item.chunkedItems=[];a.item.fileds.length>0;)a.item.chunkedItems.push(a.item.fileds.splice(0,2))}),a.showAvatar=!1,e.isImage(a.item.sso).then(function(b){a.showAvatar=b})}function j(){a.isRussia=!1,angular.forEach(b.locations,function(c){b.location==c.id&&c.isRussia&&(a.isRussia=!0)})}i(),a.ok=function(){c.close(a.item)},a.cancel=function(){c.dismiss("canceled")},a.capture=function(){f.create("app/partials/capture.html","CaptureController",{},{keyboard:!1,backdrop:"static",size:"md"}).result.then(function(b){a.item.datastream=b},function(){})}}]),app.controller("DashboardController",["$scope","$rootScope","$timeout","AppService","ScheduleService","PrintService","Utils","dialogs","$filter","$compile",function(a,b,c,d,e,f,g,h,i){function j(c){c?a.processing=!0:(a.schedules=[],a.selectedDate=new Date),$("th.h i").each(function(){$(this).removeClass().addClass("fa fa-2x fa-sort")}),b.location&&(k(),e.getSchedules(a.selectedDate).then(function(b){a.processing=!1,d.checkException(a,b.data.exception),a.schedules=b.data.data,l()}))}function k(){a.hasPrint=!1,angular.forEach(b.locations,function(c){b.location==c.id&&c.hasPrint&&(a.hasPrint=!0)})}function l(){angular.forEach(a.schedules.scheduled,function(a){a.tooltip="",a.showAvatar=!1,a.visitorPic?a.tooltip='<span class="avatar md"><img src="vm/resources/visitorphoto?recordId='+a.id+'" /></span>':(a.sso=angular.isUndefined(a.sso)||null===a.sso?"":a.sso,g.isImage(a.sso).then(function(b){a.showAvatar=b,a.showAvatar&&(a.tooltip='<span class="avatar md"><img src="http://supportcentral.gecdn.com/images/person/temp/'+a.sso+'.jpg" /></span>')}))}),angular.forEach(a.schedules.checkedin,function(a){a.tooltip="",a.showAvatar=!1,a.visitorPic?a.tooltip='<span class="avatar md"><img src="vm/resources/visitorphoto?recordId='+a.id+'" /></span>':(a.sso=angular.isUndefined(a.sso)||null===a.sso?"":a.sso,g.isImage(a.sso).then(function(b){a.showAvatar=b,a.showAvatar&&(a.tooltip='<span class="avatar md"><img src="http://supportcentral.gecdn.com/images/person/temp/'+a.sso+'.jpg" /></span>')}))})}if(!b.location)return!1;j(!1);var m=function(){j(!0),c(m,3e5)};c(m,3e5),a.changeLocation=function(c){d.updateUserAccess(c),b.location=c,k(),e.getSchedules(a.selectedDate).then(function(b){d.checkException(a,b.data.exception),a.schedules=b.data.data,l()})},a.changeDate=function(){e.getSchedules(a.selectedDate).then(function(b){d.checkException(a,b.data.exception),a.schedules=b.data.data,l()})},a.refresh=function(){j(!0)},a.showMinDate=function(){a.minDate=a.minDate?null:new Date},a.showMinDate(),a.openCalendar=function(b){b.preventDefault(),b.stopPropagation(),a.opened=!0},a.checkin=function(b,c){h.create("app/partials/checkin-modal.html","CheckInController",b,{keyboard:!1,backdrop:"static",size:"md"}).result.then(function(b){$(".actionBtn").attr("disabled","disabled");var g={id:b.id,badge:b.badge,visitor:b.visitor,instructions:b.instructions,specialInstruction:b.specialInstruction,datastream:b.datastream,adds:b.adds};e.checkin(g,a.selectedDate).then(function(b){$(".actionBtn").removeAttr("disabled");var e=d.checkException(a,b.data.exception);e||(a.schedules.statistics=b.data.data.statistics,a.schedules.scheduled.splice(c,1),a.schedules.checkedin.unshift(b.data.data.checkedin),l(),d.showMessage("success",a.translation.DASHBOARD.CHECKED_IN),a.hasPrint&&f.download(b.data.data.checkedin))})},function(){})},a.checkout=function(c,f){angular.isDefined(c.tooltip)&&delete c.tooltip,e.checkout(c,a.selectedDate).then(function(c){var e=d.checkException(a,c.data.exception);e||(a.schedules.statistics=c.data.data.statistics,a.schedules.checkedin.splice(f,1),d.showMessage("success",b.translation.DASHBOARD.CHECKED_OUT))})},a.checkInButtonVisibility=function(){return a.selectedDate>=new Date?!1:!0},b.printFile="",b.printData={},a.print=function(a){f.download(a)},a.printEmergencyList=function(){e.sendEmergecyList(),f.printEmergencyList(a,a.schedules.checkedin)},a.reverse=!1,a.sortBy=function(b,c){"scheduled"==c?a.schedules.scheduled=i("orderBy")(a.schedules.scheduled,b,a.reverse):a.schedules.checkedin=i("orderBy")(a.schedules.checkedin,b,a.reverse),$("th.h i").each(function(){$(this).removeClass().addClass("fa fa-2x fa-sort")}),a.reverse?($("th.h#"+b+"-"+c+" i").removeClass().addClass("fa fa-2x fa-sort-asc"),a.reverse=!1):($("th.h#"+b+"-"+c+" i").removeClass().addClass("fa fa-2x fa-sort-desc"),a.reverse=!0)}}]),app.controller("HelpController",["$scope","$uibModalInstance","data",function(a,b){a.cancel=function(){b.dismiss("Canceled")}}]),app.controller("LocationSettingsController",["$scope","$rootScope","AppService","LocationSettingsService",function(a,b,c,d){function e(){a.loc={},a.loc.settings={},d.getSettings().then(function(b){c.checkException(a,b.data.exception),a.customFields=b.data.data,angular.forEach(a.customFields,function(b){a.loc.settings[b.key]=b.selectedValue}),a.master=angular.copy(a.loc)})}return b.location?(e(),a.save=function(){return a.locationSettingsForm.$invalid?!1:($(".actionBtn").attr("disabled","disabled"),void d.save(a.loc.settings).then(function(d){$(".actionBtn").removeAttr("disabled");var e=c.checkException(a,d.data.exception);e||(c.showMessage("success",a.translation.LOCATION.SAVED),b.locations=d.data.data.locations,a.master=angular.copy(a.loc))}))},a.reset=function(){a.loc=angular.copy(a.master)},void a.$on("locationChange",function(){d.getSettings().then(function(b){c.checkException(a,b.data.exception),a.customFields=b.data.data,angular.forEach(a.customFields,function(b){a.loc.settings[b.key]=b.selectedValue}),a.master=angular.copy(a.loc)})})):!1}]),app.controller("MultiDateController",["$scope","$rootScope","$uibModalInstance","data","ScheduleService","AppService","$filter",function(a,b,c,d,e,f,g){function h(){a.schedule={},a.schedule.sheduledDates=[],a.schedule.availableDates=[],a.schedule.blockedDates=[],a.schedule.selectedDates=[],a.schedule.activeDate,a.schedule.id=d.id,a.schedule.startDate=new Date(d.scheduledArrival),a.schedule.endDate=new Date(d.scheduledDeparture);var b=[];angular.forEach(d.blockedDates,function(a){b.push(new Date(a))}),a.schedule.blockedDates=b;var c=a.schedule.startDate;if(a.schedule.startDate&&a.schedule.endDate)for(var e=i(a.schedule.endDate,a.schedule.startDate),f=0;e>=f;f++){var g=new Date(c.getFullYear(),c.getMonth(),c.getDate()+f,c.getHours(),c.getMinutes(),c.getSeconds()),h=a.isBlocked(g),j=h?"not-coming":"coming";g.setHours(0,0,0,0)<(new Date).setHours(0,0,0,0)?j="past":h||a.schedule.availableDates.push(g.setHours(0,0,0,0)),a.schedule.sheduledDates.push({date:g,status:j})}}function i(a,b){var c=Math.abs(a.getTime()-b.getTime()),d=Math.ceil(c/864e5);return d}a.isBlocked=function(b){var c=!1;return angular.forEach(a.schedule.blockedDates,function(a){a.setHours(0,0,0,0)===b.setHours(0,0,0,0)&&(c=!0)}),c},a.getDayClass=function(b,c){if("day"===c)for(var d=new Date(b).setHours(0,0,0,0),e=0;e<a.schedule.sheduledDates.length;e++){var f=a.schedule.sheduledDates[e].date.setHours(0,0,0,0);
if(d===f)return a.schedule.sheduledDates[e].status}return""},a.checkUncheckAll=function(){a.schedule.selectedDates=a.schedule.checkall?angular.copy(a.schedule.availableDates):[]},a.save=function(){var d=[];angular.forEach(a.schedule.selectedDates,function(a){d.push(g("date")(a,"yyyy-MM-dd HH:mm:ss"))});var h={scheduleId:a.schedule.id,dates:d};e.deleteScheduleDates(h).then(function(d){var e=f.checkException(a,d.data.exception);e||(f.showMessage("success",b.translation.SCHEDULE.UPDATED),c.close(d.data.data))})},a.cancel=function(){c.dismiss("Canceled")},h()}]),app.controller("MyVisitorController",["$scope","$rootScope","AppService","VisitorsService","Utils","dialogs",function(a,b,c,d,e,f){function g(){a.busy=!1,a.after=0,a.visitors=[],d.getVisitors().then(function(b){c.checkException(a,b.data.exception),a.visitors=b.data.data,h()})}function h(){angular.forEach(a.visitors,function(a){a.tooltip="",a.showAvatar=!1,a.visitorPic?a.tooltip='<span class="avatar md"><img src="vm/resources/visitorphoto?recordId='+a.id+'" /></span>':(a.sso=angular.isUndefined(a.sso)||null===a.sso?"":a.sso,e.isImage(a.sso).then(function(b){a.showAvatar=b,a.showAvatar&&(a.tooltip='<span class="avatar md"><img src="http://supportcentral.gecdn.com/images/person/temp/'+a.sso+'.jpg" /></span>')}))})}return b.location?(g(),a.loadMore=function(){return a.busy||a.after>=10?!1:(a.busy=!0,void d.getVisitors(a.after).then(function(b){c.checkException(a,b.data.exception),b.data.data.length&&angular.forEach(b.data.data,function(b){a.visitors.push(b)}),a.busy=!1,a.after+=1,h()}))},a.changeLocation=function(e){c.updateUserAccess(e),b.location=e,d.getVisitors().then(function(b){c.checkException(a,b.data.exception),a.visitors=b.data.data,h()})},a.hideSchedule=function(e,g){f.confirm(b.translation.DASHBOARD.DELETE_TITLE,b.translation.DASHBOARD.HIDE_CONFIRMATION,{keyboard:!1,backdrop:"static",size:"md"}).result.then(function(){var f={id:e.id,recordType:e.recordType};d.removeSchedule(f).then(function(d){var e=c.checkException(a,d.data.exception);e||(a.visitors.splice(g,1),c.showMessage("success",b.translation.DASHBOARD.HIDES))})},function(){})},void(a.help=function(){b.page="myvisitors";var a=f.create("app/partials/help.html","HelpController",{},{keyboard:!1,backdrop:"static",size:"md"});a.result.then(function(){},function(){})})):!1}]),app.controller("NoaccessController",["$scope","NoaccessService","AppService","Mailto",function(a,b,c,d){function e(){a.allLocations=[],b.getLocations().then(function(b){var d=c.checkException(a,b.data.exception);d||(a.allLocations=b.data.data)})}e(),a.ok=function(){var b=_.find(a.allLocations,function(b){return b.id==a.mylocation}),c=b.admins,e={cc:a.user.email,subject:a.translation.NOACCESS.SUBJECT+b.name,body:a.translation.NOACCESS.BODY+b.name+"."};d.send(c,e)}}]),app.controller("ReportsController",["$scope","$rootScope","AppService",function(a,b,c){function d(){a.reports=[{name:a.translation.VISITOR_REPORTS.TITLE,type:"visitor-history",icon:"fa-signal",url:"app/partials/report-templates/visitor-history.html"}],a.reportName=a.reports[0].name,a.reportIcon=a.reports[0].icon,a.ReportTemplate=a.reports[0].url,a.translation.REPORTS.TYPE=a.translation.VISITOR_REPORTS.TITLE}return b.location?(d(),a.changeLocation=function(a){c.updateUserAccess(a),b.location=a},a.$on("languageChange",function(){a.translation.REPORTS.TYPE=a.translation.VISITOR_REPORTS.TITLE}),a.changeReport=function(b){a.reportName=b.name,a.reportIcon=b.icon,a.ReportTemplate=b.url},void a.$on("languageChange",function(){a.reports=[{name:a.translation.VISITOR_REPORTS.TITLE,type:"visitor-history",icon:"fa-signal",url:"app/partials/report-templates/visitor-history.html"}],a.reportName=a.reports[0].name})):!1}]),app.controller("ScheduleController",["$scope","$rootScope","$location","$routeParams","$filter","AppService","ScheduleService","VisitorsService","Utils","dialogs",function(a,b,c,d,e,f,g,h,i,j){function k(){p(),a.schedule={},a.pastVisitorRange=0,a.departureMaxDate=0,a.showAvatar=!1,a.$watch("schedule.sso",function(){i.isImage(a.schedule.sso).then(function(b){a.showAvatar=b})}),a.webcamSupported=_.includes(["chrome","firefox","opera"],f.getBrowserType());var c=d.scheduleID?parseInt(d.scheduleID):0;a.onEditPage=c?!0:!1,a.visitorTypes=[{id:"visitor",name:b.translation.SCHEDULE.NON_GE_VISITOR},{id:"geemployee",name:b.translation.SCHEDULE.GE_EMPLOYEE},{id:"pastvisitor",name:b.translation.SCHEDULE.PAST_VISITOR}],a.visitorType="visitor",g.getPreferences().then(function(d){var h=f.checkException(a,d.data.exception);h||(a.pastVisitorRange=d.data.data.pastVisitorRange,a.departureMaxDate=d.data.data.maxScheduleRange,a.showMinDate(a.pastVisitorRange),a.showDepartureMaxDate(a.departureMaxDate),a.schedule.hosts=d.data.data.hosts,$(".instr_list").hide(),$("#instructionList option:first").html("-"+b.translation.SCHEDULE.SPECIAL_INSTRUCTIONS+"-"),a.schedule.instructionLists=d.data.data.instructions,m(d.data.data.adds),c?g.getSchedule(c).then(function(c){var d=f.checkException(a,c.data.exception);if(!d){angular.extend(a.schedule,c.data.data),a.addsMaster=angular.copy(a.schedule.adds),angular.isDefined(a.schedule.sso)&&null!=a.schedule.sso&&(a.visitorType="geemployee"),angular.forEach(a.schedule.hosts,function(b){b.id==a.schedule.hostId&&(a.schedule.host=b)}),angular.forEach(a.schedule.instructionLists,function(b){b.id==a.schedule.instructionId&&(a.schedule.instructionList=b)}),o(a.schedule.adds);var g=getTimestamp(a.schedule.scheduledArrival);a.schedule.scheduledArrival=e("date")(g,b.config.dateFormat),a.schedule.arrivalTime=createDateTime(e("date")(g,"yyyy-MM-dd"),e("date")(g,"h:mm a"));var h=getTimestamp(a.schedule.scheduledDeparture);a.schedule.scheduledDeparture=e("date")(h,b.config.dateFormat),a.schedule.departureTime=createDateTime(e("date")(h,"yyyy-MM-dd"),e("date")(h,"h:mm a")),"past"==a.schedule.recordType?(l(!1),a.createRecordBtn=!0,a.updateRecordBtn=!1,a.cancelRecordBtn=!1,a.disableArrival=!1):"currentIn"==a.schedule.recordType?(a.createRecordBtn=!1,a.updateRecordBtn=!0,a.cancelRecordBtn=!1,a.disableArrival=!0,a.minDate=a.schedule.scheduledArrival,a.showDepartureMinDate()):"currentNotIn"==a.schedule.recordType?(a.createRecordBtn=!1,a.updateRecordBtn=!0,a.cancelRecordBtn=!0,a.disableArrival=!1,a.showDepartureMinDate()):(a.createRecordBtn=!1,a.updateRecordBtn=!0,a.cancelRecordBtn=!0,a.disableArrival=!1)}}):l(!1))})}function l(b){var c=3e5,d=144e5;a.schedule.scheduledArrival=new Date,a.schedule.scheduledDeparture=new Date((new Date).getTime()+d),a.schedule.arrivalTime=new Date(Math.ceil(a.schedule.scheduledArrival.getTime()/c)*c),a.schedule.departureTime=new Date(Math.ceil(a.schedule.scheduledDeparture.getTime()/c)*c),a.showDepartureMinDate(),a.schedule.host=null,angular.forEach(a.schedule.hosts,function(b){b.id==a.user.sso&&(a.schedule.host=b)}),b&&m(a.fields)}function m(b){a.fields=b,a.schedule.adds={},a.showDefaults=!1,a.showAddition=!1,angular.isDefined(b)&&b&&(a.defaultFileds=[],a.additionalFields=[],a.additionalFieldsSelected=[],angular.forEach(b,function(b){b.visible?(a.showDefaults=!0,a.defaultFileds.push(b)):(a.showAddition=!0,a.additionalFields.push(b))}))}function n(){if(null==a.schedule.sso&&null==a.schedule.visitorId)return!1;var c={sso:f.getVal(a.schedule.sso),visitorId:f.getVal(a.schedule.visitorId),locationId:f.getVal(b.location)};g.getAdditionalFieldValues(c).then(function(b){a.extras=b.data.data,angular.forEach(a.defaultFileds,function(b){angular.forEach(a.extras,function(c,d){b.key==d&&("geemployee"!=a.visitorType||"PHONE"!=d&&"COMPANY"!=d)&&(a.schedule.adds[d]=c)})})})}function o(b){a.extras=angular.copy(b),angular.forEach(b,function(b,c){angular.forEach(a.additionalFields,function(b){b.key==c&&a.addFiled(b)})})}function p(){a.isRussia=!1,angular.forEach(b.locations,function(c){b.location==c.id&&c.isRussia&&(a.isRussia=!0)})}return b.location?(k(),a.switchLookup=function(){a.schedule.geUser=null,a.schedule.pastVisitor=null,a.schedule.recordId=null,a.schedule.visitorId=null,a.schedule.sso=null,a.schedule.firstName=null,a.schedule.lastName=null,a.schedule.email=null,a.schedule.datastream=null,a.schedule.visitorPic=null,a.schedule.adds={}},a.changeLocation=function(c){f.updateUserAccess(c),b.location=c,p(),a.schedule.host=null,a.schedule.hosts=[],$(".instr_list").show(),$("#instructionList option:first").html(b.translation.SCHEDULE.LOADING),g.getPreferences().then(function(c){var d=f.checkException(a,c.data.exception);d||(a.pastVisitorRange=c.data.data.pastVisitorRange,a.departureMaxDate=c.data.data.maxScheduleRange,a.showMinDate(a.pastVisitorRange),a.showDepartureMaxDate(a.departureMaxDate),a.schedule.hosts=c.data.data.hosts,angular.forEach(a.schedule.hosts,function(b){b.id==a.user.sso&&(a.schedule.host=b)}),$(".instr_list").hide(),$("#instructionList option:first").html("-"+b.translation.SCHEDULE.SPECIAL_INSTRUCTIONS+"-"),a.schedule.instructionLists=c.data.data.instructions,a.schedule.instructionList=null,m(c.data.data.adds),n())})},a.execute=function(c,d){if(a.scheduleForm.$invalid)return!1;if(a.schedule.arrival=createDateTime(e("date")(new Date(a.schedule.scheduledArrival),"yyyy-MM-dd"),e("date")(new Date(a.schedule.arrivalTime),"h:mm a")),a.schedule.departure=createDateTime(e("date")(new Date(a.schedule.scheduledDeparture),"yyyy-MM-dd"),e("date")(new Date(a.schedule.departureTime),"h:mm a")),a.schedule.arrival>=a.schedule.departure)return void f.showMessage("danger",b.translation.SCHEDULE.ERROR_DATE);$(".actionBtn").attr("disabled","disabled");var h={task:c,recordId:f.getVal(a.schedule.recordId),recordType:f.getVal(a.schedule.recordType),visitorId:f.getVal(a.schedule.visitorId),sso:f.getVal(a.schedule.sso),firstName:f.getVal(a.schedule.firstName),lastName:f.getVal(a.schedule.lastName),email:f.getVal(a.schedule.email),hostId:f.getVal(a.schedule.host.id),hostName:f.getVal(a.schedule.host.name),destinationName:"",escortRequired:f.getVal(a.schedule.escortRequired,!0),instructions:f.getVal(a.schedule.instructions),scheduledArrival:e("date")(a.schedule.arrival,"yyyy-MM-dd HH:mm:ss"),scheduledDeparture:e("date")(a.schedule.departure,"yyyy-MM-dd HH:mm:ss"),adds:a.schedule.adds,datastream:f.getVal(a.schedule.datastream)};a.schedule.instructionLists.length&&(a.schedule.instructionList?(h.instructionId=f.getVal(a.schedule.instructionList.id),h.instructionName=f.getVal(a.schedule.instructionList.name)):(h.instructionId=null,h.instructionName=null)),g.execute(h).then(function(e){$(".actionBtn").removeAttr("disabled");var g=f.checkException(a,e.data.exception);g||("create"==c?(d?(a.schedule.geUser=null,a.schedule.pastVisitor=null,a.schedule.visitorId=null,a.schedule.sso=null,a.schedule.firstName=null,a.schedule.lastName=null,a.schedule.email=null,a.schedule.datastream=null,a.schedule.visitorPic=null,a.schedule.adds={},l(!0)):a.resetForm(),f.showMessage("success",b.translation.SCHEDULE.CREATED)):f.showMessage("success",b.translation.SCHEDULE.UPDATED))})},a.cancelSchedule=function(){j.confirm(b.translation.DASHBOARD.DELETE_TITLE,b.translation.DASHBOARD.DELETE_CONFIRMATION).result.then(function(){var e={id:a.schedule.id,recordType:null};h.removeSchedule(e).then(function(e){var g=f.checkException(a,e.data.exception);g||f.showMessage("success",b.translation.DASHBOARD.DELETED),a.parentPage="d"==d.parentPage?"/dashboard":"/myvisitors",c.path(a.parentPage)})},function(){})},a.resetForm=function(){var b=a.schedule.hosts,c=a.schedule.instructionLists;a.schedule={},a.schedule.host=null,a.schedule.hosts=b,a.schedule.instructionLists=c,a.schedule.adds={},a.visitorType="visitor",l(!0)},a.getGEUsers=function(a){return g.getGEUsers(a).then(function(a){var b=[],c=[];return b=a.data["json-service"].services[0].response.data,angular.forEach(b,function(a){var b=angular.isUndefined(a[5])||null===a[5]?!1:a[5];b||(b=angular.isUndefined(a[4])||null===a[4]?!1:a[4],b||(b=angular.isUndefined(a[3])||null===a[3]?!1:a[3])),c.push({sso:a[0],name:a[1]+" ("+a[0]+")",firstname:a[1].split(", ")[0],lastname:a[1].split(", ")[1],phone:b,email:a[6],company:a[2]})}),c})},a.onSelectGEUser=function(b){a.schedule.visitorId=b.visitorId,a.schedule.sso=b.sso,a.schedule.firstName=b.firstname,a.schedule.lastName=b.lastname,a.schedule.email=b.email,a.schedule.adds={},a.schedule.adds.PHONE=b.phone,a.schedule.adds.COMPANY=b.company,n()},a.getPastVisitors=function(a){return g.getPastVisitors(a).then(function(a){var b=[];return angular.forEach(a.data.data,function(a){a.sso=angular.isUndefined(a.sso)||null===a.sso?"":a.sso,b.push({recordId:a.recordId,visitorId:a.visitorId,sso:a.sso,name:a.visitor,firstname:a.firstName,lastname:a.lastName,email:a.email,phone:a.phone,company:a.company,datastream:a.datastream,visitorPic:a.visitorPic})}),b})},a.onSelectPastVisitor=function(b){a.schedule.recordId=b.recordId,a.schedule.visitorId=b.visitorId,a.schedule.sso=b.sso,a.schedule.firstName=b.firstname,a.schedule.lastName=b.lastname,a.schedule.email=b.email,a.schedule.datastream=b.datastream,a.schedule.visitorPic=b.visitorPic,a.schedule.adds={},a.schedule.adds.PHONE=b.phone,a.schedule.adds.COMPANY=b.company,n()},a.getHosts=function(a){return g.getHosts(a).then(function(a){var b=[];return angular.forEach(a.data.data,function(a){b.push({id:a.sso,name:a.name})}),b})},a.openCalendar=function(b,c){b.preventDefault(),b.stopPropagation(),"arrival"==c?a.arrivalOpened=!0:a.departureOpened=!0},a.showMinDate=function(b){b=angular.isDefined(b)?b:0;var c=new Date;c.setDate(c.getDate()-b),a.minDate=c},a.showMinDate(),a.showMaxDate=function(){},a.showMaxDate(),a.showDepartureMinDate=function(){a.minDepartureDate=a.schedule.scheduledArrival},a.showDepartureMinDate(),a.showDepartureMaxDate=function(b){if(b=angular.isDefined(b)?b:0){var c=angular.isUndefined(a.schedule.scheduledArrival)?new Date:new Date(a.schedule.scheduledArrival);a.maxDepartureDate=new Date(c.getTime()+24*b*60*60*1e3)}else a.maxDepartureDate=null},a.showDepartureMaxDate(),a.changeDepartureDate=function(){a.schedule.scheduledArrival>a.schedule.scheduledDeparture&&(a.schedule.scheduledDeparture=a.schedule.scheduledArrival),a.showDepartureMinDate(),a.showDepartureMaxDate(a.departureMaxDate)},a.backButton=function(){a.parentPage=d.parentPage?d.parentPage:"",a.parentPage="d"==a.parentPage?"/dashboard":"/myvisitors",c.path(a.parentPage)},a.$on("languageChange",function(){g.getPreferences().then(function(c){var d=f.checkException(a,c.data.exception);d||($(".instr_list").hide(),$("#instructionList option:first").html("-"+b.translation.SCHEDULE.SPECIAL_INSTRUCTIONS+"-"),a.schedule.instructionLists=c.data.data.instructions)}),a.visitorTypes=[{id:"geemployee",name:b.translation.SCHEDULE.GE_EMPLOYEE},{id:"visitor",name:b.translation.SCHEDULE.NON_GE_VISITOR},{id:"pastvisitor",name:b.translation.SCHEDULE.PAST_VISITOR}]}),a.help=function(){b.page="schedule";var a=j.create("app/partials/help.html","HelpController",{},{keyboard:!1,backdrop:"static",size:"md"});a.result.then(function(){},function(){})},a.addFiled=function(c){if(f.isIE8()){var d=!1;if(angular.forEach(a.additionalFieldsSelected,function(a){c.key==a.key&&(d=!0)}),d)return void f.showMessage("danger",b.translation.SCHEDULE.ALREADY_SELECTED)}a.additionalFieldsSelected.push(c),f.isIE8()||angular.forEach(a.additionalFields,function(b,d){c.key==b.key&&a.additionalFields.splice(d,1)}),angular.forEach(a.extras,function(b,d){c.key==d&&(a.schedule.adds[d]=b)}),a.schedule.more=null},a.removeFiled=function(b,c){f.isIE8()||a.additionalFields.push(b),a.additionalFieldsSelected.splice(c,1),delete a.schedule.adds[b.key]},a.capture=function(){j.create("app/partials/capture.html","CaptureController",{},{keyboard:!1,backdrop:"static",size:"md"}).result.then(function(b){a.schedule.datastream=b},function(){})},void(a.multidate=function(){var b=j.create("app/partials/multi-date.html","MultiDateController",a.schedule,{keyboard:!1,backdrop:"static",size:"md"});b.result.then(function(b){a.schedule.blockedDates=b.blockedDates},function(){})})):!1}]),app.controller("SettingsController",["$scope","$rootScope","$cookies","$location","$timeout",function(a){a.isCollapsedUser=!1,a.isCollapsedLocation=!1}]),app.controller("UsersController",["$scope","$rootScope","AppService","UsersService","ScheduleService","Utils","dialogs","$filter","$timeout",function(a,b,c,d,e,f,g,h){function i(){a.currentUserSSO=APP.CONFIG.data.user.sso,a.user={},a.users=[],a.panes=[{title:a.translation.USERS.ADD_USERS,template:"app/partials/admin-templates/user/add-user.html"},{title:a.translation.USERS.EDIT_USERS,template:"app/partials/admin-templates/user/edit-user.html",active:!0}],a.currentTab=a.panes[1].template,k()}function j(){angular.forEach(a.users,function(a){a.sso=angular.isUndefined(a.sso)||null===a.sso?"":a.sso,a.showAvatar=!1,f.isImage(a.sso).then(function(b){a.showAvatar=b})})}function k(){d.getUsers().then(function(b){c.checkException(a,b.data.exception),a.users=b.data.data.users,a.access=b.data.data.access,angular.forEach(a.access,function(b){b.name=a.translation.USERS[b.id]}),j()})}return b.location?(i(),a.$on("locationChange",function(a,d){b.location=d,c.updateUserAccess(b.location),i()}),a.$on("languageChange",function(){a.panes[0].title=a.translation.USERS.ADD_USERS,a.panes[1].title=a.translation.USERS.EDIT_USERS,angular.forEach(a.access,function(b){b.name=a.translation.USERS[b.id]})}),a.onClickTab=function(b){a.currentTab=b.template,angular.forEach(a.panes,function(a){a.active=!1}),b.active=!0},a.getUsers=function(a){return e.getGEUsers(a).then(function(a){var b=a.data["json-service"].services[0].response.data,c=[];return angular.forEach(b,function(a){var b=angular.isUndefined(a[5])||null===a[5]?!1:a[5];b||(b=angular.isUndefined(a[4])||null===a[4]?!1:a[4],b||(b=angular.isUndefined(a[3])||null===a[3]?!1:a[3])),c.push({sso:a[0],name:a[1]+" ("+a[0]+")",firstName:a[1].split(", ")[0],lastName:a[1].split(", ")[1],phone:b,email:a[6],company:a[2]})}),c})},a.onSelectUser=function(d){var e=!1;angular.forEach(a.users,function(a){var b=angular.isUndefined(a.sso)||null===a.sso?"":a.sso;d.sso==b&&(e=!0)}),e?(c.showMessage("danger",b.translation.USERS.EXISTING),a.resetForm()):(a.user={},angular.extend(a.user,d))},a.addUser=function(){return angular.isUndefined(a.user.access)?!1:void d.addUser(a.user).then(function(d){var e=c.checkException(a,d.data.exception);e||(c.showMessage("success",b.translation.USERS.ADDED),a.resetForm(),a.currentTab=a.panes[1].template,angular.forEach(a.panes,function(a){a.active=!1}),a.panes[1].active=!0,k())})},a.remove=function(e,f){g.confirm(b.translation.DASHBOARD.DELETE_TITLE,b.translation.USERS.DELETE_CONFIRMATION,{keyboard:!1,backdrop:"static",size:"md"}).result.then(function(){var g={sso:e.sso,access:e.access};d.removeUser(g).then(function(d){var e=c.checkException(a,d.data.exception);e||(a.users.splice(f,1),c.showMessage("success",b.translation.USERS.DELETED))})},function(){})},a.help=function(){b.page="myusers";var a=g.create("app/partials/help.html","HelpController",{},{keyboard:!1,backdrop:"static",size:"md"});a.result.then(function(){},function(){})},a.showAccessLevel=function(c){if(c.access&&a.access.length){var d=h("filter")(a.access,{id:c.access});return d.length?b.translation.USERS[d[0].id]:"Not set"}return b.translation.USERS[c.access]||"Not set"},a.saveUser=function(e,f){angular.extend(e,{sso:f}),d.updateAccessLevel(e).then(function(d){var e=c.checkException(a,d.data.exception);e?i():c.showMessage("success",b.translation.USERS.UPDATED)})},void(a.resetForm=function(){a.user={},a.searchUser=null})):!1}]),app.controller("VisitorHistoryController",["$scope","$rootScope","$filter",function(a,b,c){function d(){a.startDate=new Date,a.endDate=new Date,a.openCalendar=function(b,c){b.preventDefault(),b.stopPropagation(),"start"==c?(a.startOpened=!0,a.endOpened=!1):(a.startOpened=!1,a.endOpened=!0)},a.showMinDate=function(){},a.showMinDate(),a.showMaxDate=function(){a.maxDate=new Date},a.showMaxDate(),a.showEndMinDate=function(){a.minEndDate=a.startDate},a.showEndMinDate(),a.showEndMaxDate=function(){a.maxEndDate=new Date},a.showEndMaxDate(),a.changeEndDate=function(){a.startDate>a.endDate&&(a.endDate=a.startDate),a.showEndMinDate()},a.downloadReport=function(){var d=c("date")(a.startDate,"MMM d, y"),e=c("date")(a.endDate,"MMM d, y"),f=b.location;return $.download("VMHistoryReport","fromDate="+d+"&&toDate="+e+"&&langCode="+b.langCode+"&&locationId="+f),!1},a.resetForm=function(){a.startDate=new Date,a.endDate=new Date,a.showEndMinDate()}}return b.location?void d():!1}]),app.service("AppService",["$rootScope","$http","$window","$timeout","$q","$location","ngToast",function(a,b,c,d,e,f,g){this.getVal=function(a,b){var c=b?!1:null;return angular.isUndefined(a)?c:a},this.checkException=function(b,c){return 1==c.status?(b.translation.EXCEPTIONS.hasOwnProperty(c.code)||(c.code=101),16012==c.code||16013==c.code?(this.showMessage("danger",a.translation.EXCEPTIONS[c.code]+c.message+a.translation.EXCEPTIONS.COMMON),!0):(this.showMessage("danger",a.translation.EXCEPTIONS[c.code]),!0)):!1},this.showMessage=function(a,b){"success"==a?g.success({content:b}):"danger"==a?g.danger({content:b}):"warning"==a?g.warning({content:b}):g.info({content:b})},this.systemError=function(){this.showMessage("danger",a.translation.EXCEPTIONS[100])},this.updateUserAccess=function(b){angular.forEach(a.locations,function(a){if(a.id==b){initUser(a.role);var c=APP.PAGEACCESS[f.path().replace("/","")];APP.USER.ROLE&c||f.path(APP.USER.LANDING)}})},this.getBrowserType=function(){var a=c.navigator.userAgent,b={ipad:/ipad/i,chrome:/chrome/i,firefox:/firefox/i,safari:/safari/i,opera:/opera/i,ie:/(msie|trident)/i};for(var d in b)if(b[d].test(a))return d;return"unknown"},this.isIE8=function(){return document.documentMode&&document.documentMode<9}}]),app.service("ScheduleService",["$rootScope","$http","$filter","AppService",function(a,b,c,d){this.getSchedules=function(e){var f={data:{langCode:a.langCode,locationId:a.location,scheduledArrival:c("date")(e,"yyyy-MM-dd HH:mm:ss")}},g=b.post("vm/resources/home",f).success(function(a){return a.data}).error(function(){d.systemError()});return g},this.execute=function(c){c.langCode=a.langCode,c.locationId=a.location;var e={data:c},f=b.post("vm/resources/scheduleVisitor",e).success(function(a){return a.data}).error(function(){d.systemError()});return f},this.getSchedule=function(c){var e={data:{id:c,langCode:a.langCode,locationId:a.location}},f=b.post("vm/resources/schedule",e).success(function(a){return a.data}).error(function(){d.systemError()});return f},this.checkin=function(e,f){e.langCode=a.langCode,e.locationId=a.location,e.scheduledArrival=f,e.checkInTime=c("date")(new Date,"yyyy-MM-dd HH:mm:ss");var g={data:e},h=b.post("vm/resources/checkin",g).success(function(a){return a.data}).error(function(){d.systemError()});return h},this.checkout=function(e,f){e.langCode=a.langCode,e.locationId=a.location,e.scheduledArrival=f,e.checkOutTime=c("date")(new Date,"yyyy-MM-dd HH:mm:ss");var g={data:e},h=b.post("vm/resources/checkout",g).success(function(a){return a.data}).error(function(){d.systemError()});return h},this.sendEmergecyList=function(){var e="",f=c("date")(new Date,"MMM d, y h:mm a");angular.forEach(a.locations,function(b){b.id==a.location&&(e=b.name)});var g={data:{langCode:a.langCode,locationId:a.location,locationName:e,date:f}},h=b.post("vm/resources/sendmail",g).success(function(a){return a.data}).error(function(){d.systemError()});return h},this.getPreferences=function(){var c={data:{langCode:a.langCode,locationId:a.location}},e=b.post("vm/resources/locationInfo",c).success(function(a){return a.data}).error(function(){d.systemError()});return e},this.getGEUsers=function(a){var c="http://services.dmt.corporate.ge.com/lookupservices/json/person/"+a+"/1/20/extra/email,phone?callback=JSON_CALLBACK",d=b.jsonp(c).success(function(){return!0}).error(function(){});return d},this.getPastVisitors=function(c){var e={data:{query:c,langCode:a.langCode,locationId:a.location}},f=b.post("vm/resources/pastlookup",e).success(function(a){return a.data}).error(function(){d.systemError()});return f},this.getHosts=function(c){var e={data:{query:c,langCode:a.langCode,locationId:a.location}},f=b.post("vm/resources/hosts",e).success(function(a){return a.data}).error(function(){d.systemError()});return f},this.bulkSchedule=function(c){c.langCode=a.langCode,c.locationId=a.location;var e={data:c},f=b.post("vm/resources/bulkSchedule",e).success(function(a){return a.data}).error(function(){d.systemError()});return f},this.getAdditionalFieldValues=function(a){var c={data:a},e=b.post("vm/resources/userAddtlsFields",c).success(function(a){return a.data}).error(function(){d.systemError()});return e},this.getAdditionalFields=function(c){var e={data:{id:c,langCode:a.langCode,locationId:a.location}},f=b.post("vm/resources/editCheckin",e).success(function(a){return a.data}).error(function(){d.systemError()});return f},this.deleteScheduleDates=function(c){var e={data:{id:c.scheduleId,dates:c.dates,langCode:a.langCode,locationId:a.location}},f=b.post("vm/resources/removeScheduleDates",e).success(function(a){return a.data}).error(function(){d.systemError()});return f}}]),app.service("VisitorsService",["$rootScope","$http","AppService",function(a,b,c){this.getVisitors=function(){var d={data:{langCode:a.langCode,locationId:a.location}},e=b.post("vm/resources/myvisitors",d).success(function(a){return a.data}).error(function(){c.systemError()});return e},this.removeSchedule=function(d){d.langCode=a.langCode,d.locationId=a.location;var e={data:d},f=b.post("vm/resources/remove",e).success(function(a){return a.data}).error(function(){c.systemError()});return f},this.getBannedVisitors=function(){var d={data:{langCode:a.langCode,locationId:a.location}},e=b.post("vm/resources/bannedvisitors",d).success(function(a){return a.data}).error(function(){c.systemError()});return e},this.removeBann=function(d){d.langCode=a.langCode,d.locationId=a.location;var e={data:d},f=b.post("vm/resources/removebann",e).success(function(a){return a.data}).error(function(){c.systemError()});return f},this.getBannedVisitor=function(d){var e={data:{langCode:a.langCode,locationId:a.location,recordId:d}},f=b.post("vm/resources/bannedvisitor",e).success(function(a){return a.data}).error(function(){c.systemError()});return f},this.bann=function(d){d.langCode=a.langCode,d.locationId=a.location;var e={data:d},f=b.post("vm/resources/bann",e).success(function(a){return a.data}).error(function(){c.systemError()});return f},this.getVisitorPic=function(d){var e={data:{langCode:a.langCode,locationId:a.location,recordId:d}},f=b.post("vm/resources/visitorpic",e).success(function(a){return a.data}).error(function(){c.systemError()});return f}}]),app.service("BannedScheduleService",["$rootScope","$http","$filter","AppService",function(a,b,c,d){this.getSchedules=function(){var c={data:{langCode:a.langCode,locationId:a.location}},e=b.post("vm/resources/bannedschedules",c).success(function(a){return a.data}).error(function(){d.systemError()});return e},this.approve=function(c){c.langCode=a.langCode,c.locationId=a.location,c.task="approve";var e={data:c},f=b.post("vm/resources/managependingschedule",e).success(function(a){return a.data}).error(function(){d.systemError()});return f},this.reject=function(c){c.langCode=a.langCode,c.locationId=a.location,c.task="reject";var e={data:c},f=b.post("vm/resources/managependingschedule",e).success(function(a){return a.data}).error(function(){d.systemError()});return f}}]),app.service("PrintService",["$rootScope","$http","$timeout","$window","$filter","AppService",function(a,b,c,d,e,f){this.print=function(e,g){var h=!1,i="p";return angular.forEach(a.locations,function(b){b.id==a.location&&b.hasPrint&&(h=b.name.replace(/[^\w\s-]/g,"").trim().toLowerCase(),h=h.replace(/[-\s]+/g,"-"))}),h?("plano-shil-tx-us"==h&&(i="l"),a.printFile="app/partials/badge-templates/"+h+".html",a.printData=g,void b.get(a.printFile).success(function(){c(function(){d.print()},500)}).error(function(){a.printFile="app/partials/badge-templates/default.html",b.get(a.printFile).success(function(){c(function(){d.print()},500)}).error(function(){f.showMessage("danger",a.translation.GLOBAL.NOFILE)})})):!1},this.printEmergencyList=function(g,h){var i="";angular.forEach(a.locations,function(b){b.id==a.location&&(i=b.name)}),a.printFile="app/partials/emergency-list.html",a.printData.schedules=h,a.printData.locationName=i,a.printData.time=e("date")(new Date,"MMM d, y h:mm a"),b.get(a.printFile).success(function(){c(function(){d.print()},500)}).error(function(){a.printFile="app/partials/emergency-list.html",b.get(a.printFile).success(function(){c(function(){d.print()},500)}).error(function(){f.showMessage("danger",a.translation.GLOBAL.NOFILE)})})},this.download=function(b){var c={};return c.id=b.id,c.visitorFirstName=b.visitorFirstName,c.visitorLastName=b.visitorLastName,c.escortRequired=b.escortRequired,c.company=b.company,c.badge=b.badge,c.code=b.code,c.host=b.host,c.createdDate=b.timestamp,c.locationId=a.location,$.download("badge",c,"post"),!1}}]),app.service("UsersService",["$rootScope","$http","AppService",function(a,b,c){this.getUsers=function(){var d={data:{langCode:a.langCode,locationId:a.location}},e=b.post("vm/resources/admin/guardslist",d).success(function(a){return a.data}).error(function(){c.systemError()});return e},this.addUser=function(d){d.langCode=a.langCode,d.locationId=a.location;var e={data:d},f=b.post("vm/resources/admin/addguard",e).success(function(a){return a.data}).error(function(){c.systemError()});return f},this.removeUser=function(d){d.langCode=a.langCode,d.locationId=a.location;var e={data:d},f=b.post("vm/resources/admin/removeguard",e).success(function(a){return a.data}).error(function(){c.systemError()});return f},this.updateAccessLevel=function(d){d.langCode=a.langCode,d.locationId=a.location;var e={data:d},f=b.post("vm/resources/admin/editguard",e).success(function(a){return a.data}).error(function(){c.systemError()});return f}}]),app.service("LocationSettingsService",["$rootScope","$http","AppService",function(a,b,c){this.getSettings=function(){var d={data:{langCode:a.langCode,locationId:a.location}},e=b.post("vm/resources/settings",d).success(function(a){return a.data}).error(function(){c.systemError()});return e},this.save=function(d){d.langCode=a.langCode,d.locationId=a.location;var e={data:d},f=b.post("vm/resources/savelocsettings",e).success(function(a){return a.data}).error(function(){c.systemError()});return f}}]),app.service("NoaccessService",["$rootScope","$http","AppService",function(a,b,c){this.getLocations=function(){var d={data:{langCode:a.langCode}},e=b.post("vm/resources/getlocations",d).success(function(a){return a.data}).error(function(){c.systemError()});return e}}]),app.factory("Utils",["$q","$http","$templateCache","$compile","AppService",function(a,b,c,d,e){return{isImage:function(b){var c="http://supportcentral.gecdn.com/images/person/temp/"+b+".jpg",d=a.defer(),e=new Image;return e.onerror=function(){d.resolve(!1)},e.onload=function(){d.resolve(!0)},e.src=c,d.promise},renderBlock:function(a){var c="app/partials/"+a,d=b.get(c).success(function(a){return a}).error(function(){e.systemError()});return d}}}]),app.factory("Mailto",["$window",function(a){var b={};return b.send=function(b,c){recepient=angular.isArray(b)?b.join(";"):b;var d="mailto:";d+=window.encodeURIComponent(recepient);var e=[];angular.forEach(c,function(a,b){e.push(b.toLowerCase()+"="+window.encodeURIComponent(a))}),e.length>0&&(d+="?"+e.join("&")),a.location=d},b}]),app.filter("futureDatesOnly",function(){return function(a){var b=[],c=(new Date).setHours(0,0,0,0);return angular.forEach(a,function(a){new Date(a.date).setHours(0,0,0,0)>=c&&b.push(a)}),b}}),app.directive("avatar",["$q",function(a){var b=window.URL||window.webkitURL,c=function(a,b){var c=b.resizeMaxHeight||300,d=b.resizeMaxWidth||250,e=b.resizeQuality||.7,f=b.resizeType||"image/png",g=document.createElement("canvas");g.style.display="none",document.body.appendChild(g);var h=a.height,i=a.width;i>h?i>d&&(h=Math.round(h*=d/i),i=d):h>c&&(i=Math.round(i*=c/h),h=c),g.width=i,g.height=h;
var j=g.getContext("2d");return j.drawImage(a,0,0,i,h),g.toDataURL(f,e)},d=function(b){var c=a.defer(),d=new FileReader;return d.onload=function(a){c.resolve(a.target.result)},d.readAsDataURL(b),c.promise};return{restrict:"A",scope:{avatar:"="},link:function(a,e,f){var g=f.hasOwnProperty("avatarAttrs")&&a.$eval(f.avatarAttrs);"undefined"==typeof e.length&&(e=[e]),angular.forEach(e,function(e){var f;"INPUT"===e.tagName&&"file"===e.type?f=e:(f=document.createElement("input"),f.setAttribute("type","file"),angular.extend(f.style,{visibility:"hidden",position:"absolute"}),angular.forEach(g,function(a,b){f.setAttribute(b,a)}),e.appendChild(f),e.addEventListener("click",function(){f.click()},!1)),f.addEventListener("change",function(e){for(var f=e.target.files,g=0;g<f.length;g++){var h={file:f[g],url:b.createObjectURL(f[g])};d(f[g]).then(function(b){h.dataURL=b,a.avatar=h.dataURL;var d=new Image;d.onload=function(){var b=c(d,a);h.resized={dataURL:b,type:b.match(/:(.+\/.+);/)[1]},a.$apply(function(){a.avatar=b})},d.src=h.url})}})})}}}]),app.directive("placeholder",["$log","$timeout",function(a,b){return{restrict:"A",link:function(a,c,d){var e=parseInt((/msie (\d+)/.exec(angular.lowercase(navigator.userAgent))||[])[1]);if(!(10>=e))return!1;var f=d.placeholder;c.bind("focus",function(){c.val()===f&&c.val(""),a.$apply()}),c.bind("blur",function(){""===c.val()&&c.val(f),a.$apply()}),b(function(){""===c.val()&&c.val(f),a.$apply()}),a.$on("languageChange",function(){b(function(){f=d.placeholder,""===c.val()&&c.val(f),a.$apply()})})}}}]),app.directive("intlTel",["$rootScope",function(a){return{replace:!0,restrict:"E",require:"ngModel",template:'<input type="text" placeholder="e.g. +1 702 123 4567" class="form-control" name="phone" />',link:function(b,c,d,e){var f=function(){var a=c.val();e.$setViewValue(a)};c.intlTelInput({defaultCountry:a.countryCode}),c.on("focus blur keyup change",function(){b.$apply(f)}),f()}}}]),window.console=window.console||{},window.console.log=window.console.log||function(){},String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/gm,"")}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){for(var c=b||0,d=this.length;d>c;c++)if(this[c]===a)return c;return-1}),$.download=function(a,b,c,d){if(a&&b){b="string"==typeof b?b:$.param(b);var e="";$.each(b.split("&"),function(){var a=this.split("=");e+='<input type="hidden" name="'+a[0]+'" value="'+a[1]+'" />'}),$('<form action="'+a+'" target="'+(d||"_blank")+'"" method="'+(c||"post")+'">'+e+"</form>").appendTo("body").submit().remove()}},$("document").ready(function(){$("input").attr("autocomplete","off"),$("#side-menu").metisMenu(),$(function(){$(window).bind("load",function(){$(this).width()<753?$("div.sidebar-collapse").addClass("collapse"):$("div.sidebar-collapse").removeClass("collapse")})}),$(function(){$(window).bind("resize",function(){this.innerWidth<768?$("div.sidebar-collapse").addClass("collapse"):$("div.sidebar-collapse").removeClass("collapse")})})});